<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>CGN JoyManna Radio - Smart Skip System</title>
    <style>
/* ===============================
   GLOBAL RESET
================================ */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

/* ===============================
   BODY (STUDIO BACKGROUND)
================================ */
body {
    font-family: 'Malgun Gothic', 'ÎßëÏùÄ Í≥†Îîï', sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    background:
        radial-gradient(circle at top, #1e293b 0%, #020617 70%);
    color: #e5e7eb;
    overflow: hidden;
}

/* ===============================
   RADIO PANEL
================================ */
.radio-container {
    width: 92%;
    max-width: 420px;
    background: linear-gradient(
        180deg,
        rgba(30, 41, 59, 0.95),
        rgba(2, 6, 23, 0.95)
    );
    border-radius: 18px;
    padding: 16px 14px;
    border: 1px solid rgba(255, 255, 255, 0.08);
    box-shadow:
        0 30px 60px rgba(0,0,0,0.65),
        inset 0 1px 0 rgba(255,255,255,0.04);
    backdrop-filter: blur(14px);
}

/* ===============================
   HEADER
================================ */
.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 14px;
}

.title {
    font-size: 15px;
    font-weight: 700;
    letter-spacing: 0.4px;
}

/* ON AIR INDICATOR */
.on-air {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 11px;
    font-weight: bold;
    color: #f87171;
}

.on-air-dot {
    width: 8px;
    height: 8px;
    background: #ef4444;
    border-radius: 50%;
    animation: pulse 1.5s infinite;
}

@keyframes pulse {
    0%   { opacity: 1; }
    50%  { opacity: 0.4; }
    100% { opacity: 1; }
}

/* ===============================
   INFO PANEL
================================ */
.info-panel {
    background: rgba(2, 6, 23, 0.6);
    border-radius: 12px;
    padding: 10px 12px;
    margin-bottom: 14px;
}

.info-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 12px;
    margin-bottom: 6px;
}

.info-row:last-child {
    margin-bottom: 0;
}

.label {
    color: #94a3b8;
}

.value.program {
    color: #38bdf8;
    font-weight: 600;
}

.value.track {
    color: #fbbf24;
    font-weight: 600;
}

/* ===============================
   AUDIO
================================ */
audio {
    width: 100%;
    margin-top: 8px;
    filter: brightness(1.1);
}

/* ===============================
   CONTROL BUTTON
================================ */
#playBtn {
    width: 100%;
    margin-top: 14px;
    padding: 12px 0;
    background: linear-gradient(180deg, #10b981, #059669);
    border: none;
    border-radius: 14px;
    font-size: 13px;
    font-weight: 700;
    color: #ecfdf5;
    cursor: pointer;
    letter-spacing: 0.6px;
    box-shadow:
        0 6px 12px rgba(0,0,0,0.4),
        inset 0 1px 0 rgba(255,255,255,0.3);
    transition: all 0.15s ease;
}

#playBtn:hover {
    filter: brightness(1.05);
}

#playBtn:active {
    transform: translateY(1px);
    box-shadow:
        0 4px 8px rgba(0,0,0,0.4),
        inset 0 2px 4px rgba(0,0,0,0.3);
}

/* ===============================
   STATUS MESSAGE
================================ */
#statusMessage {
    margin-top: 10px;
    font-size: 11px;
    color: #cbd5f5;
    text-align: center;
    min-height: 14px;
}
</style>
</head>
<body>
    <div class="radio-container">
        <h1 id="theme-title">üé∂ CGN JoyManna Radio</h1>
        <p id="current-time">ÏãúÍ∞Å Î°úÎî© Ï§ë...</p>
        <div id="info">Î∞©ÏÜ° ÎåÄÍ∏∞ Ï§ë</div>
        <div id="track-info">Ï§ÄÎπÑ ÏôÑÎ£å</div>
    
        <audio id="player" controls></audio>
        <button id="playBtn">‚ñ∂ PLAY</button>
        <p id="statusMessage"></p>
    </div>

<script>
    const player = document.getElementById("player");
    const info = document.getElementById("info");
    const trackInfo = document.getElementById("track-info");
    const playBtn = document.getElementById("playBtn");
    const statusMessageEl = document.getElementById("statusMessage");
    const currentTimeEl = document.getElementById("current-time");

    let isPlayerStarted = false;
    let currentTrackIndex = 1;
    let skipAttemptCount = 0; // ÌååÏùºÏù¥ ÏóÜÏùÑ Îïå ÎÑòÍ∏∞Í∏∞ ÏãúÎèÑ ÌöüÏàò Ï†úÌïú

    // 1. Ï†ëÏÜç ÌôòÍ≤ΩÏóê Îî∞Î•∏ BASE_URL ÏûêÎèô ÏÑ§Ï†ï
    //const BASE_URL = window.location.hostname.includes('github.io') 
    //    ? "https://cgnjoymanna.synology.me/radio/";
     //   : "https://andrewkangkl-design.github.io/CGN_JoyManna/";
    const BASE_URL = "https://andrewkangkl-design.github.io/CGN_JoyManna/";
    console.log("URL:" + BASE_URL);

    // 2. ÏöîÏùºÎ≥Ñ ÌÖåÎßà ÏÉâÏÉÅ Ï†ïÏùò
    const THEMES = [
        "linear-gradient(135deg, #450a0a, #7f1d1d)", // Ïùº (Red)
        "linear-gradient(135deg, #0f172a, #1e293b)", // Ïõî (Slate)
        "linear-gradient(135deg, #064e3b, #134e4a)", // Ìôî (Emerald)
        "linear-gradient(135deg, #1e1b4b, #312e81)", // Ïàò (Indigo)
        "linear-gradient(135deg, #422006, #713f12)", // Î™© (Amber)
        "linear-gradient(135deg, #2e1065, #4c1d95)", // Í∏à (Purple)
        "linear-gradient(135deg, #18181b, #27272a)"  // ÌÜ† (Zinc)
    ];

    // 3. Ïä§ÏºÄÏ§Ñ ÏÑ§Ï†ï (timeFolderÏôÄ fileCount ÌïÑÏàò)
    const SCHEDULE_CONFIG = {
        'sun': [{ start: [0, 0], end: [23, 59], name: "Ï£ºÏùº Ï†ÑÏùº Ï∞¨Ïñë", timeFolder: "0000", fileCount: 20 }],
        'mon': [{ start: [6, 0], end: [23, 59], name: "ÏõîÏöî ÏïÑÏπ®Ïùò Î¨µÏÉÅ", timeFolder: "0600", fileCount: 10 }],
        'tue': [{ start: [6, 0], end: [23, 59], name: "ÌôîÏöî ÏùÄÌòúÏùò ÎåÄÎ°ú", timeFolder: "0600", fileCount: 10 }],
        'wed': [{ start: [6, 0], end: [23, 59], name: "ÏàòÏöî Í∞êÏÇ¨Ïùò Ï∞¨Ïñë", timeFolder: "0600", fileCount: 10 }],
        'thu': [{ start: [6, 0], end: [23, 59], name: "Î™©Ïöî ÌèâÌôîÏùò Í∏∞ÎèÑ", timeFolder: "0600", fileCount: 18 }],
        'fri': [{ start: [6, 0], end: [23, 59], name: "Í∏àÏöî ÏÑ±Î†πÏùò Î∂àÍ∏∏", timeFolder: "0600", fileCount: 10 }],
        'sat': [{ start: [6, 0], end: [23, 59], name: "ÌÜ†Ïöî ÏÜåÎßùÏùò ÎÖ∏Îûò", timeFolder: "0600", fileCount: 10 }]
    };

    const DAYS_SHORT = ['sun', 'mon', 'tue', 'wed', 'thu', 'fri', 'sat'];

    function getFormattedDate() {
        const now = new Date();
        return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;
    }

    function getCurrentProgram() {
        const now = new Date();
        const dayKey = DAYS_SHORT[now.getDay()];
        const currentMinutes = now.getHours() * 60 + now.getMinutes();
        const todaySchedule = SCHEDULE_CONFIG[dayKey];
        if (!todaySchedule) return null;
        return todaySchedule.find(p => {
            const minStart = p.start[0] * 60 + p.start[1];
            const minEnd = p.end[0] * 60 + p.end[1];
            return currentMinutes >= minStart && currentMinutes <= minEnd;
        });
    }

    // Ïû¨ÏÉù Ìï®Ïàò
    function loadAndPlay(program) {
        if (!program) return;
        const dateFolder = getFormattedDate();
        const url = `${BASE_URL}${dateFolder}/${program.timeFolder}/${currentTrackIndex}.mp3`;
        
        player.src = url;
        trackInfo.textContent = `ÌòÑÏû¨ ÌååÏùº: ${currentTrackIndex}Î≤à (Ï†ÑÏ≤¥ ${program.fileCount}Í∞ú Ï§ë)`;
        
        player.play().then(() => {
            skipAttemptCount = 0; // ÏÑ±Í≥µÌïòÎ©¥ Ïä§ÌÇµ Ïπ¥Ïö¥Ìä∏ Ï¥àÍ∏∞Ìôî
            statusMessageEl.textContent = "";
            playBtn.style.display = "none";
        }).catch(err => {
            console.log("ÏûêÎèô Ïû¨ÏÉù ÎåÄÍ∏∞ Ï§ë...");
        });
    }

    // ‚òÖ ÌïµÏã¨: ÌååÏùºÏù¥ ÏóÜÏùÑ Îïå Ïä§ÌÇµÌïòÎäî Î°úÏßÅ
    player.onerror = function() {
        if (!isPlayerStarted) return;
        
        const program = getCurrentProgram();
        if (program) {
            console.warn(`${currentTrackIndex}.mp3 ÌååÏùº ÏóÜÏùå. Ïä§ÌÇµÌï©ÎãàÎã§.`);
            skipAttemptCount++;
            
            // Ìè¥Îçî ÎÇ¥ ÌååÏùº Í∞úÏàòÎßåÌÅº ÏãúÎèÑÌñàÎäîÎç∞ÎèÑ Îã§ ÏóÜÏúºÎ©¥ Ï§ëÎã® (Î¨¥Ìïú Î£®ÌîÑ Î∞©ÏßÄ)
            if (skipAttemptCount >= program.fileCount) {
                statusMessageEl.textContent = "Ìï¥Îãπ Ìè¥ÎçîÏóê Ïû¨ÏÉù Í∞ÄÎä•Ìïú ÌååÏùºÏù¥ ÌïòÎÇòÎèÑ ÏóÜÏäµÎãàÎã§.";
                isPlayerStarted = false;
                return;
            }

            currentTrackIndex++;
            if (currentTrackIndex > program.fileCount) currentTrackIndex = 1;
            
            statusMessageEl.textContent = "ÌååÏùºÏùÑ Ï∞æÎäî Ï§ë... (Îã§Ïùå Î≤àÌò∏Î°ú Í±¥ÎÑàÎõ∞Í∏∞)";
            loadAndPlay(program);
        }
    };

    // Í≥°Ïù¥ ÎÅùÎÇ¨ÏùÑ Îïå Îã§Ïùå Í≥°ÏúºÎ°ú Ïù¥Îèô
    player.onended = function() {
        const program = getCurrentProgram();
        if (program) {
            currentTrackIndex++;
            if (currentTrackIndex > program.fileCount) currentTrackIndex = 1;
            loadAndPlay(program);
        }
    };

    function updateRadio() {
        const now = new Date();
        const dayIndex = now.getDay();
        const program = getCurrentProgram();
        
        // ÏöîÏùºÎ≥Ñ Î∞∞Í≤Ω ÌÖåÎßà Î≥ÄÍ≤Ω
        document.body.style.background = THEMES[dayIndex];
        
        currentTimeEl.textContent = `ÌòÑÏû¨ ÏãúÍ∞Å: ${now.toLocaleTimeString('ko-KR', { hour12: false })} (${DAYS_SHORT[dayIndex].toUpperCase()})`;

        if (program) {
            info.textContent = `On-Air: ${program.name}`;
            
            // Ïû¨ÏÉù Ï§ëÏù∏Îç∞ ÎÇ†ÏßúÎÇò ÏãúÍ∞Ñ Ìè¥ÎçîÍ∞Ä Î∞îÎÄåÏóàÏùÑ Í≤ΩÏö∞ Î¶¨ÏÖã
            if (isPlayerStarted) {
                const currentPath = `${getFormattedDate()}/${program.timeFolder}/`;
                if (!player.src.includes(currentPath)) {
                    currentTrackIndex = 1;
                    loadAndPlay(program);
                }
            }
        } else {
            info.textContent = "ÌòÑÏû¨Îäî Î∞©ÏÜ° Ïä§ÏºÄÏ§ÑÏù¥ ÏóÜÏäµÎãàÎã§.";
            trackInfo.textContent = "-";
            player.pause();
        }
    }

    playBtn.addEventListener("click", () => {
        const program = getCurrentProgram();
        if (program) {
            isPlayerStarted = true;
            skipAttemptCount = 0;
            currentTrackIndex = 1; 
            loadAndPlay(program);
        } else {
            alert("Î∞©ÏÜ° ÏãúÍ∞ÑÏù¥ ÏïÑÎãôÎãàÎã§.");
        }
    });

    setInterval(updateRadio, 10000);
    updateRadio();
</script>
</body>
</html>
