<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>CGN JoyManna Radio - Smart Skip System</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: "Noto Sans KR", sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            //background: #1e293b; /* Í∏∞Î≥∏ Î∞∞Í≤Ω */
            transition: background 1s ease-in-out;
            color: #fffff;
        }

        .radio-container {
            text-align: center;
            background: rgba(15, 23, 42, 0.85);
            padding: 1px;
            border-radius: 12px;
            width: 90%;
            max-width: 450px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 5px 10px -12px rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(20px);
        }

        h1 { font-size: 1.0rem; margin-bottom: 5px; letter-spacing: -0.5px; }
        #current-time { font-size: 0.85rem; color: #94a3b8; margin-bottom: 5px; }
        #info { font-size: 0.9rem; font-weight: bold; color: #38bdf8; margin-bottom: 5px; }
        #track-info { font-size: 0.9rem; color: #fbbf24; margin-bottom: 5px; }

        audio { width: 90%; margin-top: 5px; filter: invert(100%) hue-rotate(180deg); opacity: 0.8; }

        #playBtn {
            margin-top: 5px;
            background: #10b981;
            border: none;
            padding: 5px;
            border-radius: 15px;
            color: white;
            font-size: 1.0rem;
            font-weight: bold;
            cursor: pointer;
            width: 30%;
            transition: all 0.2s;
        }
        #playBtn:hover { background: #059669; transform: scale(1.02); }
        
        #statusMessage { font-size: 0.8rem; color: #f87171; margin-top: 5px; min-height: 10px; }
    </style>
</head>
<body>
    <div class="radio-container">
        <h1 id="theme-title">üé∂ CGN JoyManna Radio</h1>
        <p id="current-time">ÏãúÍ∞Å Î°úÎî© Ï§ë...</p>
        <div id="info">Î∞©ÏÜ° ÎåÄÍ∏∞ Ï§ë</div>
        <div id="track-info">Ï§ÄÎπÑ ÏôÑÎ£å</div>
    
        <audio id="player" controls></audio>
        <button id="playBtn">‚ñ∂ PLAY</button>
        <p id="statusMessage"></p>
    </div>

<script>
    const player = document.getElementById("player");
    const info = document.getElementById("info");
    const trackInfo = document.getElementById("track-info");
    const playBtn = document.getElementById("playBtn");
    const statusMessageEl = document.getElementById("statusMessage");
    const currentTimeEl = document.getElementById("current-time");

    let isPlayerStarted = false;
    let currentTrackIndex = 1;
    let skipAttemptCount = 0; // ÌååÏùºÏù¥ ÏóÜÏùÑ Îïå ÎÑòÍ∏∞Í∏∞ ÏãúÎèÑ ÌöüÏàò Ï†úÌïú

    // 1. Ï†ëÏÜç ÌôòÍ≤ΩÏóê Îî∞Î•∏ BASE_URL ÏûêÎèô ÏÑ§Ï†ï
    //const BASE_URL = window.location.hostname.includes('github.io') 
    //    ? "https://cgnjoymanna.synology.me/radio/";
     //   : "https://andrewkangkl-design.github.io/CGN_JoyManna/";
    const BASE_URL = "https://andrewkangkl-design.github.io/CGN_JoyManna/";
    console.log("URL:" + BASE_URL);

    // 2. ÏöîÏùºÎ≥Ñ ÌÖåÎßà ÏÉâÏÉÅ Ï†ïÏùò
    const THEMES = [
        "linear-gradient(135deg, #450a0a, #7f1d1d)", // Ïùº (Red)
        "linear-gradient(135deg, #0f172a, #1e293b)", // Ïõî (Slate)
        "linear-gradient(135deg, #064e3b, #134e4a)", // Ìôî (Emerald)
        "linear-gradient(135deg, #1e1b4b, #312e81)", // Ïàò (Indigo)
        "linear-gradient(135deg, #422006, #713f12)", // Î™© (Amber)
        "linear-gradient(135deg, #2e1065, #4c1d95)", // Í∏à (Purple)
        "linear-gradient(135deg, #18181b, #27272a)"  // ÌÜ† (Zinc)
    ];

    // 3. Ïä§ÏºÄÏ§Ñ ÏÑ§Ï†ï (timeFolderÏôÄ fileCount ÌïÑÏàò)
    const SCHEDULE_CONFIG = {
        'sun': [{ start: [0, 0], end: [23, 59], name: "Ï£ºÏùº Ï†ÑÏùº Ï∞¨Ïñë", timeFolder: "0000", fileCount: 20 }],
        'mon': [{ start: [6, 0], end: [23, 59], name: "ÏõîÏöî ÏïÑÏπ®Ïùò Î¨µÏÉÅ", timeFolder: "0600", fileCount: 10 }],
        'tue': [{ start: [6, 0], end: [23, 59], name: "ÌôîÏöî ÏùÄÌòúÏùò ÎåÄÎ°ú", timeFolder: "0600", fileCount: 10 }],
        'wed': [{ start: [6, 0], end: [23, 59], name: "ÏàòÏöî Í∞êÏÇ¨Ïùò Ï∞¨Ïñë", timeFolder: "0600", fileCount: 10 }],
        'thu': [{ start: [6, 0], end: [23, 59], name: "Î™©Ïöî ÌèâÌôîÏùò Í∏∞ÎèÑ", timeFolder: "0600", fileCount: 18 }],
        'fri': [{ start: [6, 0], end: [23, 59], name: "Í∏àÏöî ÏÑ±Î†πÏùò Î∂àÍ∏∏", timeFolder: "0600", fileCount: 10 }],
        'sat': [{ start: [6, 0], end: [23, 59], name: "ÌÜ†Ïöî ÏÜåÎßùÏùò ÎÖ∏Îûò", timeFolder: "0600", fileCount: 10 }]
    };

    const DAYS_SHORT = ['sun', 'mon', 'tue', 'wed', 'thu', 'fri', 'sat'];

    function getFormattedDate() {
        const now = new Date();
        return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;
    }

    function getCurrentProgram() {
        const now = new Date();
        const dayKey = DAYS_SHORT[now.getDay()];
        const currentMinutes = now.getHours() * 60 + now.getMinutes();
        const todaySchedule = SCHEDULE_CONFIG[dayKey];
        if (!todaySchedule) return null;
        return todaySchedule.find(p => {
            const minStart = p.start[0] * 60 + p.start[1];
            const minEnd = p.end[0] * 60 + p.end[1];
            return currentMinutes >= minStart && currentMinutes <= minEnd;
        });
    }

    // Ïû¨ÏÉù Ìï®Ïàò
    function loadAndPlay(program) {
        if (!program) return;
        const dateFolder = getFormattedDate();
        const url = `${BASE_URL}${dateFolder}/${program.timeFolder}/${currentTrackIndex}.mp3`;
        
        player.src = url;
        trackInfo.textContent = `ÌòÑÏû¨ ÌååÏùº: ${currentTrackIndex}Î≤à (Ï†ÑÏ≤¥ ${program.fileCount}Í∞ú Ï§ë)`;
        
        player.play().then(() => {
            skipAttemptCount = 0; // ÏÑ±Í≥µÌïòÎ©¥ Ïä§ÌÇµ Ïπ¥Ïö¥Ìä∏ Ï¥àÍ∏∞Ìôî
            statusMessageEl.textContent = "";
            playBtn.style.display = "none";
        }).catch(err => {
            console.log("ÏûêÎèô Ïû¨ÏÉù ÎåÄÍ∏∞ Ï§ë...");
        });
    }

    // ‚òÖ ÌïµÏã¨: ÌååÏùºÏù¥ ÏóÜÏùÑ Îïå Ïä§ÌÇµÌïòÎäî Î°úÏßÅ
    player.onerror = function() {
        if (!isPlayerStarted) return;
        
        const program = getCurrentProgram();
        if (program) {
            console.warn(`${currentTrackIndex}.mp3 ÌååÏùº ÏóÜÏùå. Ïä§ÌÇµÌï©ÎãàÎã§.`);
            skipAttemptCount++;
            
            // Ìè¥Îçî ÎÇ¥ ÌååÏùº Í∞úÏàòÎßåÌÅº ÏãúÎèÑÌñàÎäîÎç∞ÎèÑ Îã§ ÏóÜÏúºÎ©¥ Ï§ëÎã® (Î¨¥Ìïú Î£®ÌîÑ Î∞©ÏßÄ)
            if (skipAttemptCount >= program.fileCount) {
                statusMessageEl.textContent = "Ìï¥Îãπ Ìè¥ÎçîÏóê Ïû¨ÏÉù Í∞ÄÎä•Ìïú ÌååÏùºÏù¥ ÌïòÎÇòÎèÑ ÏóÜÏäµÎãàÎã§.";
                isPlayerStarted = false;
                return;
            }

            currentTrackIndex++;
            if (currentTrackIndex > program.fileCount) currentTrackIndex = 1;
            
            statusMessageEl.textContent = "ÌååÏùºÏùÑ Ï∞æÎäî Ï§ë... (Îã§Ïùå Î≤àÌò∏Î°ú Í±¥ÎÑàÎõ∞Í∏∞)";
            loadAndPlay(program);
        }
    };

    // Í≥°Ïù¥ ÎÅùÎÇ¨ÏùÑ Îïå Îã§Ïùå Í≥°ÏúºÎ°ú Ïù¥Îèô
    player.onended = function() {
        const program = getCurrentProgram();
        if (program) {
            currentTrackIndex++;
            if (currentTrackIndex > program.fileCount) currentTrackIndex = 1;
            loadAndPlay(program);
        }
    };

    function updateRadio() {
        const now = new Date();
        const dayIndex = now.getDay();
        const program = getCurrentProgram();
        
        // ÏöîÏùºÎ≥Ñ Î∞∞Í≤Ω ÌÖåÎßà Î≥ÄÍ≤Ω
        document.body.style.background = THEMES[dayIndex];
        
        currentTimeEl.textContent = `ÌòÑÏû¨ ÏãúÍ∞Å: ${now.toLocaleTimeString('ko-KR', { hour12: false })} (${DAYS_SHORT[dayIndex].toUpperCase()})`;

        if (program) {
            info.textContent = `On-Air: ${program.name}`;
            
            // Ïû¨ÏÉù Ï§ëÏù∏Îç∞ ÎÇ†ÏßúÎÇò ÏãúÍ∞Ñ Ìè¥ÎçîÍ∞Ä Î∞îÎÄåÏóàÏùÑ Í≤ΩÏö∞ Î¶¨ÏÖã
            if (isPlayerStarted) {
                const currentPath = `${getFormattedDate()}/${program.timeFolder}/`;
                if (!player.src.includes(currentPath)) {
                    currentTrackIndex = 1;
                    loadAndPlay(program);
                }
            }
        } else {
            info.textContent = "ÌòÑÏû¨Îäî Î∞©ÏÜ° Ïä§ÏºÄÏ§ÑÏù¥ ÏóÜÏäµÎãàÎã§.";
            trackInfo.textContent = "-";
            player.pause();
        }
    }

    playBtn.addEventListener("click", () => {
        const program = getCurrentProgram();
        if (program) {
            isPlayerStarted = true;
            skipAttemptCount = 0;
            currentTrackIndex = 1; 
            loadAndPlay(program);
        } else {
            alert("Î∞©ÏÜ° ÏãúÍ∞ÑÏù¥ ÏïÑÎãôÎãàÎã§.");
        }
    });

    setInterval(updateRadio, 10000);
    updateRadio();
</script>
</body>
</html>
