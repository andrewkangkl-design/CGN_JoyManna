<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>CGN JoyManna Radio - Smart Skip System</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: "Noto Sans KR", sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
			background: rgba(30, 40, 59, 0.8); /*trnsparent put little bit */
			/*background gradiation is cover overall */
			/*background: linear-gradient(135deg, #0f172a, #1e293b);*/
			outside padding make 0;
            margin: 0;
			padding: 0;
			overflow: hidden; /*scroll disabled*/
        }

        .radio-container {
            text-align: center;
            /*background: rgba(15, 23, 42, 0.85);/*ì›ë˜ ìˆëŠ” ìƒ‰ê¹”*/
            padding: 1px;
            border-radius: 12px;
            width: 90%;
            max-width: 450px;
      		border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 12px rgba(0, 0, 0, 0.3);	
			/*backdrop-filter: blur(10px); /* ë°°ê²½ íë¦¼ íš¨ê³¼ë¡œ ê¸€ì ê°€ë…ì„± í–¥ìƒ */
			background: linear-gradient(180deg, rgba(30, 41, 59, 0.55), rgba(2, 6, 23, 0.55));
	    	backdrop-filter: blur(18px) saturate(120%);
    		-webkit-backdrop-filter: blur(18px) saturate(120%);
        }

        h1 { font-size: 1.0rem; margin-bottom: 5px; letter-spacing: -0.5px;}
        #current-time { font-size: 0.85rem; color: #94a3b8; margin-bottom: 5px; }
        #info { font-size: 0.9rem; font-weight: bold; color: #38bdf8; margin-bottom: 5px; }
        #track-info { font-size: 0.9rem; color: #fbbf24; margin-bottom: 5px; }

        audio { width: 90%; margin-top: 5px; filter: invert(100%) hue-rotate(180deg); opacity: 0.8; }

        #playBtn {
            margin-top: 5px;
            background: #10b981;
            border: none;
            padding: 5px;
            border-radius: 12px;
            color: white;
            font-size: 1.0rem;
            font-weight: bold;
            cursor: pointer;
            width: 30%;
            transition: all 0.2s;
        }
        #playBtn:hover { background: #059669; transform: scale(1.02); }
        
        #statusMessage { font-size: 0.8rem; color: #f87171; margin-top: 5px; min-height: 10px; }
    </style>
</head>
<body>
    <div class="radio-container">
        <h1 id="theme-title">ğŸ¶ CGN JoyManna Radio</h1>
        <p id="current-time">ì‹œê° ë¡œë”© ì¤‘...</p>
        <div id="info">ë°©ì†¡ ëŒ€ê¸° ì¤‘</div>
        <div id="track-info">ì¤€ë¹„ ì™„ë£Œ</div>
    
        <audio id="player" controls></audio>
        <button id="playBtn">â–¶ PLAY</button>
        <p id="statusMessage"></p>
    </div>

<script>
    const player = document.getElementById("player");
    const info = document.getElementById("info");
    const trackInfo = document.getElementById("track-info");
    const playBtn = document.getElementById("playBtn");
    const statusMessageEl = document.getElementById("statusMessage");
    const currentTimeEl = document.getElementById("current-time");

    let isPlayerStarted = false;
    let currentTrackIndex = 1;
    let skipAttemptCount = 0; // íŒŒì¼ì´ ì—†ì„ ë•Œ ë„˜ê¸°ê¸° ì‹œë„ íšŸìˆ˜ ì œí•œ

    // 1. ì ‘ì† í™˜ê²½ì— ë”°ë¥¸ BASE_URL ìë™ ì„¤ì •
    //const BASE_URL = window.location.hostname.includes('github.io') 
    //    ? "https://cgnjoymanna.synology.me/radio/";
     //   : "https://andrewkangkl-design.github.io/CGN_JoyManna/";
    const BASE_URL = "https://andrewkangkl-design.github.io/CGN_JoyManna/";
    console.log("URL:" + BASE_URL);

    // 2. ìš”ì¼ë³„ í…Œë§ˆ ìƒ‰ìƒ ì •ì˜
    const THEMES = [
        "linear-gradient(135deg, #450a0a, #7f1d1d)", // ì¼ (Red)
        "linear-gradient(135deg, #0f172a, #1e293b)", // ì›” (Slate)
        "linear-gradient(135deg, #064e3b, #134e4a)", // í™” (Emerald)
        "linear-gradient(135deg, #1e1b4b, #312e81)", // ìˆ˜ (Indigo)
        "linear-gradient(135deg, #422006, #713f12)", // ëª© (Amber)
        "linear-gradient(135deg, #2e1065, #4c1d95)", // ê¸ˆ (Purple)
        "linear-gradient(135deg, #18181b, #27272a)"  // í†  (Zinc)
    ];

    // 3. ìŠ¤ì¼€ì¤„ ì„¤ì • (timeFolderì™€ fileCount í•„ìˆ˜)
    const SCHEDULE_CONFIG = {
        'sun': [{ start: [0, 0], end: [23, 59], name: "ì£¼ì¼ ì „ì¼ ì°¬ì–‘", timeFolder: "0000", fileCount: 20 }],
        'mon': [{ start: [6, 0], end: [23, 59], name: "ì›”ìš” ì•„ì¹¨ì˜ ë¬µìƒ", timeFolder: "0600", fileCount: 10 }],
        'tue': [{ start: [6, 0], end: [23, 59], name: "í™”ìš” ì€í˜œì˜ ëŒ€ë¡œ", timeFolder: "0600", fileCount: 10 }],
        'wed': [{ start: [6, 0], end: [23, 59], name: "ìˆ˜ìš” ê°ì‚¬ì˜ ì°¬ì–‘", timeFolder: "0600", fileCount: 10 }],
        'thu': [{ start: [6, 0], end: [23, 59], name: "ëª©ìš” í‰í™”ì˜ ê¸°ë„", timeFolder: "0600", fileCount: 18 }],
        'fri': [{ start: [6, 0], end: [23, 59], name: "ê¸ˆìš” ì„±ë ¹ì˜ ë¶ˆê¸¸", timeFolder: "0600", fileCount: 10 }],
        'sat': [{ start: [6, 0], end: [23, 59], name: "í† ìš” ì†Œë§ì˜ ë…¸ë˜", timeFolder: "0600", fileCount: 10 }]
    };

    const DAYS_SHORT = ['sun', 'mon', 'tue', 'wed', 'thu', 'fri', 'sat'];

    function getFormattedDate() {
        const now = new Date();
        return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;
    }

    function getCurrentProgram() {
        const now = new Date();
        const dayKey = DAYS_SHORT[now.getDay()];
        const currentMinutes = now.getHours() * 60 + now.getMinutes();
        const todaySchedule = SCHEDULE_CONFIG[dayKey];
        if (!todaySchedule) return null;
        return todaySchedule.find(p => {
            const minStart = p.start[0] * 60 + p.start[1];
            const minEnd = p.end[0] * 60 + p.end[1];
            return currentMinutes >= minStart && currentMinutes <= minEnd;
        });
    }

    // ì¬ìƒ í•¨ìˆ˜
    function loadAndPlay(program) {
        if (!program) return;
        const dateFolder = getFormattedDate();
        const url = `${BASE_URL}${dateFolder}/${program.timeFolder}/${currentTrackIndex}.mp3`;
        
        player.src = url;
        trackInfo.textContent = `í˜„ì¬ íŒŒì¼: ${currentTrackIndex}ë²ˆ (ì „ì²´ ${program.fileCount}ê°œ ì¤‘)`;
        
        player.play().then(() => {
            skipAttemptCount = 0; // ì„±ê³µí•˜ë©´ ìŠ¤í‚µ ì¹´ìš´íŠ¸ ì´ˆê¸°í™”
            statusMessageEl.textContent = "";
            playBtn.style.display = "none";
        }).catch(err => {
            console.log("ìë™ ì¬ìƒ ëŒ€ê¸° ì¤‘...");
        });
    }

    // â˜… í•µì‹¬: íŒŒì¼ì´ ì—†ì„ ë•Œ ìŠ¤í‚µí•˜ëŠ” ë¡œì§
    player.onerror = function() {
        if (!isPlayerStarted) return;
        
        const program = getCurrentProgram();
        if (program) {
            console.warn(`${currentTrackIndex}.mp3 íŒŒì¼ ì—†ìŒ. ìŠ¤í‚µí•©ë‹ˆë‹¤.`);
            skipAttemptCount++;
            
            // í´ë” ë‚´ íŒŒì¼ ê°œìˆ˜ë§Œí¼ ì‹œë„í–ˆëŠ”ë°ë„ ë‹¤ ì—†ìœ¼ë©´ ì¤‘ë‹¨ (ë¬´í•œ ë£¨í”„ ë°©ì§€)
            if (skipAttemptCount >= program.fileCount) {
                statusMessageEl.textContent = "í•´ë‹¹ í´ë”ì— ì¬ìƒ ê°€ëŠ¥í•œ íŒŒì¼ì´ í•˜ë‚˜ë„ ì—†ìŠµë‹ˆë‹¤.";
                isPlayerStarted = false;
                return;
            }

            currentTrackIndex++;
            if (currentTrackIndex > program.fileCount) currentTrackIndex = 1;
            
            statusMessageEl.textContent = "íŒŒì¼ì„ ì°¾ëŠ” ì¤‘... (ë‹¤ìŒ ë²ˆí˜¸ë¡œ ê±´ë„ˆë›°ê¸°)";
            loadAndPlay(program);
        }
    };

    // ê³¡ì´ ëë‚¬ì„ ë•Œ ë‹¤ìŒ ê³¡ìœ¼ë¡œ ì´ë™
    player.onended = function() {
        const program = getCurrentProgram();
        if (program) {
            currentTrackIndex++;
            if (currentTrackIndex > program.fileCount) currentTrackIndex = 1;
            loadAndPlay(program);
        }
    };

    function updateRadio() {
        const now = new Date();
        const dayIndex = now.getDay();
        const program = getCurrentProgram();
        
        // ìš”ì¼ë³„ ë°°ê²½ í…Œë§ˆ ë³€ê²½
        document.body.style.background = THEMES[dayIndex];
        
        currentTimeEl.textContent = `í˜„ì¬ ì‹œê°: ${now.toLocaleTimeString('ko-KR', { hour12: false })} (${DAYS_SHORT[dayIndex].toUpperCase()})`;

        if (program) {
            info.textContent = `On-Air: ${program.name}`;
            
            // ì¬ìƒ ì¤‘ì¸ë° ë‚ ì§œë‚˜ ì‹œê°„ í´ë”ê°€ ë°”ë€Œì—ˆì„ ê²½ìš° ë¦¬ì…‹
            if (isPlayerStarted) {
                const currentPath = `${getFormattedDate()}/${program.timeFolder}/`;
                if (!player.src.includes(currentPath)) {
                    currentTrackIndex = 1;
                    loadAndPlay(program);
                }
            }
        } else {
            info.textContent = "í˜„ì¬ëŠ” ë°©ì†¡ ìŠ¤ì¼€ì¤„ì´ ì—†ìŠµë‹ˆë‹¤.";
            trackInfo.textContent = "-";
            player.pause();
        }
    }

    playBtn.addEventListener("click", () => {
        const program = getCurrentProgram();
        if (program) {
            isPlayerStarted = true;
            skipAttemptCount = 0;
            currentTrackIndex = 1; 
            loadAndPlay(program);
        } else {
            alert("ë°©ì†¡ ì‹œê°„ì´ ì•„ë‹™ë‹ˆë‹¤.");
        }
    });

    setInterval(updateRadio, 10000);
    updateRadio();
</script>
</body>
</html>
