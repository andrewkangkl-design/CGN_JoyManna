<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>ìš”ì¼ + ì‹œê°„ëŒ€ë³„ ìë™ ë¼ë””ì˜¤</title>
    <style>
        body {
            font-family: "Noto Sans KR", sans-serif;
            background: linear-gradient(135deg, #141e30, #243b55);
            color: #fff;
            text-align: center;
            padding: 10px 20px;
        }

        h1 {
            font-size: 1.2rem;
            margin-bottom: 10px;
        }
        
        #current-time {
            font-size: 0.9rem;
            margin-bottom: 5px;
            color: #ccc;
        }

        #info {
            font-size: 1.1rem;
            margin-bottom: 10px;
            font-weight: bold;
            min-height: 25px; /* ë†’ì´ í™•ë³´ */
        }

        audio {
            width: 90%;
            margin-top: 10px;
            background-color: #333;
            border-radius: 5px;
        }

        #playBtn {
            margin-top: 10px;
            background: #00bcd4;
            border: none;
            padding: 8px 20px;
            border-radius: 10px;
            color: white;
            font-size: 1.0rem;
            cursor: pointer;
            transition: background 0.3s;
        }

        #playBtn:hover {
            background: #0097a7;
        }
        
        #statusMessage {
            font-size: 0.8rem;
            color: #ffcc00;
            margin-top: 5px;
            min-height: 15px;
        }
    </style>
</head>
<body>
    <h1>ğŸ¶ ìš”ì¼ë³„ 24ì‹œê°„ ë¼ë””ì˜¤ ë°©ì†¡</h1>
    <p id="current-time">í˜„ì¬ ì‹œê° ë¡œë”© ì¤‘...</p>
    <p id="info">í˜„ì¬ ì¬ìƒ ì¤‘: ì‹œì‘ ëŒ€ê¸° ì¤‘...</p>
    
    <audio id="player" controls loop></audio><br/>
    <button id="playBtn">â–¶ ì¬ìƒ ì‹œì‘</button>
    <p id="statusMessage"></p>

<script>
    const player = document.getElementById("player");
    const info = document.getElementById("info");
    const playBtn = document.getElementById("playBtn");
    const statusMessageEl = document.getElementById("statusMessage");
    const currentTimeEl = document.getElementById("current-time");

    // ì‹œê°„ê³¼ ë¶„ì„ ë°›ì•„ì„œ í•˜ë£¨ì˜ ì´ ë¶„(minute)ìœ¼ë¡œ ê³„ì‚°í•˜ëŠ” í—¬í¼ í•¨ìˆ˜
    function timeToMinutes(hour, minute) {
        return hour * 60 + minute;
    }

    // â˜…â˜…â˜… ìŠ¤ì¼€ì¤„ ë°ì´í„°: ìš”ì¼(0=ì¼~6=í† )ê³¼ ë¶„ ë‹¨ìœ„ ì‹œê°„ ì„¤ì • â˜…â˜…â˜…
    // [ì‹œ, ë¶„]ì„ timeToMinutes í—¬í¼ í•¨ìˆ˜ë¡œ ì§ì ‘ ë³€í™˜í•˜ì—¬ ì‚¬ìš©í•©ë‹ˆë‹¤.
    const APPS_SCRIPT_URL = "https://andrewkangkl-design.github.io/CGN_JoyManna/"; // ê¸°ë³¸ URL
    
    const SCHEDULE_DATA = {
        // ì¼ìš”ì¼ (0)
        0: [
            { start: timeToMinutes(10, 0), end: timeToMinutes(11, 30), name: "ì£¼ì¼ ì˜¤ì „ ì˜ˆë°°", url: APPS_SCRIPT_URL + "sun_sermon.mp3" },
            { start: timeToMinutes(18, 0), end: timeToMinutes(23, 59), name: "ì£¼ì¼ ì €ë… ê¸°ë„", url: APPS_SCRIPT_URL + "sun_evening.mp3" },
            { start: timeToMinutes(0, 0), end: timeToMinutes(9, 59), name: "ì£¼ì¼ ìƒˆë²½ ì°¬ì–‘", url: APPS_SCRIPT_URL + "sun_dawn.mp3" },
        ],
        // ì›”ìš”ì¼ (1) ~ í† ìš”ì¼ (6) ìŠ¤ì¼€ì¤„ì€ ë™ì¼í•˜ë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤.
        1: [
            { start: timeToMinutes(6, 0), end: timeToMinutes(11, 59), name: "ì›”ìš” ì•„ì¹¨ ì°¬ì–‘", url: APPS_SCRIPT_URL + "mon_morning.mp3" },
            { start: timeToMinutes(12, 0), end: timeToMinutes(17, 29), name: "ì›”ìš” ë‚® ì„¤êµ ë°©ì†¡", url: APPS_SCRIPT_URL + "mon_sermon.mp3" },
            { start: timeToMinutes(17, 30), end: timeToMinutes(23, 59), name: "ì›”ìš” ì €ë… ê¸°ë„ ìŒì•…", url: APPS_SCRIPT_URL + "mon_evening_prayer.mp3" },
            { start: timeToMinutes(0, 0), end: timeToMinutes(5, 59), name: "ì›”ìš” ìƒˆë²½ ë¬µìƒ", url: APPS_SCRIPT_URL + "mon_dawn.mp3" },
        ],
        // í™”ìš”ì¼ (2) ~ ê¸ˆìš”ì¼ (5) - ì›”ìš”ì¼ê³¼ ë™ì¼í•œ ìŠ¤ì¼€ì¤„ì„ ì‚¬ìš©í•˜ê±°ë‚˜ ê°œë³„ ì„¤ì • ê°€ëŠ¥
        2: [
            { start: timeToMinutes(6, 0), end: timeToMinutes(11, 59), name: "í™”ìš” ì•„ì¹¨ ì°¬ì–‘", url: APPS_SCRIPT_URL + "tue_morning.mp3" },
            { start: timeToMinutes(12, 0), end: timeToMinutes(17, 29), name: "í™”ìš” ë‚® ì„¤êµ ë°©ì†¡", url: APPS_SCRIPT_URL + "tue_sermon.mp3" },
            { start: timeToMinutes(17, 30), end: timeToMinutes(23, 59), name: "í™”ìš” ì €ë… ê¸°ë„ ìŒì•…", url: APPS_SCRIPT_URL + "tue_evening_prayer.mp3" },
            { start: timeToMinutes(0, 0), end: timeToMinutes(5, 59), name: "í™”ìš” ìƒˆë²½ ë¬µìƒ", url: APPS_SCRIPT_URL + "tue_dawn.mp3" },
        ],
        // ... 3, 4, 5, 6 ìš”ì¼ë„ í•„ìš”ì— ë”°ë¼ ë³µì‚¬í•˜ì—¬ ì‚¬ìš©í•˜ì„¸ìš”.
        // í˜„ì¬ëŠ” 1(ì›”)ì˜ ìŠ¤ì¼€ì¤„ì„ ê¸°ë³¸ê°’ìœ¼ë¡œ ì‚¬ìš©í•œë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤.
        
        // ìŠ¤ì¼€ì¤„ì´ ì •ì˜ë˜ì§€ ì•Šì€ ìš”ì¼ì˜ ê¸°ë³¸ê°’
        'default': [
            { start: timeToMinutes(0, 0), end: timeToMinutes(23, 59), name: "ì—°ì† ë°©ì†¡ (ê¸°ë³¸)", url: APPS_SCRIPT_URL + "default_loop.mp3" }
        ]
    };
    
    let isPlayerStarted = false; 

    function getCurrentProgram() {
        const now = new Date();
        const day = now.getDay(); // 0 (ì¼) ~ 6 (í† )
        const currentMinutes = now.getHours() * 60 + now.getMinutes();
        
        const todaySchedule = SCHEDULE_DATA[day] || SCHEDULE_DATA['default'] || [];

        // í˜„ì¬ ì‹œê°ì„ ë¶„ ë‹¨ìœ„ë¡œ ë¹„êµí•˜ì—¬ í•´ë‹¹ë˜ëŠ” í”„ë¡œê·¸ë¨ ì°¾ê¸°
        const program = todaySchedule.find(p => currentMinutes >= p.start && currentMinutes <= p.end);
        
        return program;
    }

    function updateRadio() {
        const now = new Date();
        const program = getCurrentProgram();
        
        // í˜„ì¬ ì‹œê° í‘œì‹œ
        currentTimeEl.textContent = "í˜„ì¬ ì‹œê°: " + now.toLocaleTimeString('ko-KR', { hour12: false }) + " (" + 
                                   ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '][now.getDay()] + "ìš”ì¼)";

        if (program) {
            info.textContent = `í˜„ì¬ ì¬ìƒ ì¤‘: ${program.name}`;
            
            if (isPlayerStarted) {
                // 1. URLì´ ë³€ê²½ë˜ì—ˆëŠ”ì§€ í™•ì¸ (ë‹¤ìŒ ìŠ¤ì¼€ì¤„ ì‹œê°„ëŒ€ë¡œ ë„˜ì–´ê°)
                if (player.src !== program.url) {
                    player.src = program.url;
                    player.load(); 
                    
                    player.play().then(() => {
                        statusMessageEl.textContent = "";
                        playBtn.style.display = "none"; // ìë™ ì „í™˜ ì„±ê³µ ì‹œ ë²„íŠ¼ ìˆ¨ê¹€
                    }).catch(err => {
                        console.error("ìë™ ì „í™˜ ì¬ìƒ ì‹¤íŒ¨:", err);
                        statusMessageEl.textContent = "â— ìë™ ì¬ìƒì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. ì¬ìƒ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.";
                        playBtn.style.display = "block"; // ì‹¤íŒ¨ ì‹œ ë²„íŠ¼ ì¬í‘œì‹œ
                    });
                } 
                // 2. URLì€ ë™ì¼í•œë° í”Œë ˆì´ì–´ê°€ ë©ˆì¶°ìˆëŠ”ì§€ í™•ì¸ (íŒŒì¼ ëë‚¨)
                else if (player.paused && !player.error) { 
                    player.play().catch(err => {
                        // ìë™ ì¬ìƒ ì¬ì‹œë„ ì‹¤íŒ¨ëŠ” ì£¼ë¡œ ë¸Œë¼ìš°ì €ì˜ ì œì•½ ë•Œë¬¸ì…ë‹ˆë‹¤.
                        console.error("íŒŒì¼ ì¢…ë£Œ í›„ ìë™ ì¬ì‹œë„ ì‹¤íŒ¨:", err);
                    });
                }
            } else {
                info.textContent = `ë‹¤ìŒ ë°©ì†¡: ${program.name} (ì¬ìƒ ëŒ€ê¸° ì¤‘)`;
                player.src = program.url; // URL ë¯¸ë¦¬ ë¡œë“œ
                playBtn.style.display = "block"; // ì¬ìƒ ì‹œì‘ ë²„íŠ¼ í‘œì‹œ
            }

        } else {
            // ë°©ì†¡ ì‹œê°„ì´ ì•„ë‹ ë•Œ
            info.textContent = "í˜„ì¬ëŠ” ë°©ì†¡ ì‹œê°„ëŒ€ê°€ ì•„ë‹™ë‹ˆë‹¤.";
            player.pause();
            player.src = ""; 
            if(isPlayerStarted) {
                 statusMessageEl.textContent = "ë‹¤ìŒ ë°©ì†¡ ì‹œê°„ëŒ€ë¥¼ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.";
            }
            playBtn.style.display = "none";
        }
    }

    // === ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ: ì¬ìƒ ì‹œì‘ ë²„íŠ¼ ì²˜ë¦¬ ===
    playBtn.addEventListener("click", () => {
        const program = getCurrentProgram();
        if (!program) {
             statusMessageEl.textContent = "í˜„ì¬ëŠ” ë°©ì†¡ ì‹œê°„ì´ ì•„ë‹™ë‹ˆë‹¤.";
             return;
        }

        if (!isPlayerStarted) {
            isPlayerStarted = true;
            // ìµœì´ˆ ì¬ìƒ ì‹œë„
            player.src = program.url; // ë‹¤ì‹œ í™•ì‹¤í•˜ê²Œ ì„¤ì •
            
            player.play()
                .then(() => {
                    playBtn.style.display = "none";
                    statusMessageEl.textContent = "";
                    info.textContent = `í˜„ì¬ ì¬ìƒ ì¤‘: ${program.name}`;
                })
                .catch(error => {
                    console.error("ì²« ì¬ìƒ ì˜¤ë¥˜:", error);
                    statusMessageEl.textContent = `ì¬ìƒì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. (ë¸Œë¼ìš°ì € ì •ì±…). ë²„íŠ¼ì„ ë‹¤ì‹œ ëˆŒëŸ¬ì£¼ì„¸ìš”.`;
                    isPlayerStarted = false; // ì¬ìƒ ì‹¤íŒ¨ ì‹œ ìƒíƒœ ì´ˆê¸°í™”
                });
        }
    });

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™” ë° ì‹œê°„ í‘œì‹œ
    updateRadio();

    // ìŠ¤ì¼€ì¤„ ë³€ê²½ì„ ì¦‰ì‹œ ê°ì§€í•˜ê¸° ìœ„í•´ 5ì´ˆë§ˆë‹¤ ì‹¤í–‰
    setInterval(updateRadio, 5000); 
</script>
</body>
</html>
