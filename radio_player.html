<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>CGN JoyManna Radio </title>
    <style>
		 {
    	/* 모든 요소의 여백 초기화 및 크기 계산 방식 통일 */
    	margin: 0;
    	padding: 0;
    	box-sizing: border-box;
	  }

        /* (스타일 시트는 이전과 동일합니다) */
        body {
            font-family: 'Malgun Gothic', '맑은 고딕', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
			// *background gradiation is cover overall
			background: linear-gradient(135deg, #0f172a, #1e293b);
			//outside padding make 0
            margin: 0;
			padding: 0;
			overflow: hidden; //scroll disabled
        }
        .radio-container {
            text-align: center;
			background: rgba(30, 40, 59, 0.7); //trnsparent put little bit
            //background: #ffffff;
            padding: 15px;
            border-radius: 15px;
			width: 90%;
            max-width: 400px;
			/* 테두리에 살짝 빛을 주어 어두운 배경과 분리 */
			border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 12px rgba(0, 0, 0, 0.3);	
			backdrop-filter: blur(10px); /* 배경 흐림 효과로 글자 가독성 향상 */ㅠ     }
        h2 {
            color: #ffffff;
            margin-bottom: 10px;
			font-size: 12px;
			text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        p {
            font-size: 11px;
            color: #cbd5e1;
            margin: 10px 0;
        }
        #program-name {
            font-weight: bold;
            color: #38bdf8;
            font-size: 11px;
			display: inline;
    		margin-top: 5px;
        }
		#current-time {
    		color: #94a3b8;
    		font-size: 12px;
  		}
        #radioPlayer {
            width: 100%;
            margin-top: 10px;
			/* 오디오 플레이어의 색상은 브라우저 기본값을 따르지만 
       		다크모드 브라우저 환경에서 더 잘 보입니다. */
        }
        #startButton {
            padding: 10px 10px;
            margin-top: 5px;
            background-color: #10b981;
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 11px;
            font-weight: bold;
			box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
    		transition: all 0.2s ease;
        }
        #startButton:hover {
            background-color: #059669;
			transform: scale(-2px)
        }
        .status-message {
            margin-top: 10px;
            color: #fbbf24;
            font-weight: bold;
            min-height: 15px;
        }
		.on-air-text {
    	font-size: 14px;
    	color: #cbd5e1; /* 밝은 은회색 */
    	margin: 10px 0;
    
    	/* 한 줄 표시를 위한 핵심 설정 */
    	display: flex;             /* 요소들을 가로로 정렬 */
    	justify-content: center;   /* 가운데 정렬 */
    	align-items: center;       /* 세로 수평 맞춤 */
    	gap: 8px;                  /* 글자와 프로그램명 사이 간격 */
    	white-space: nowrap;       /* 화면이 좁아져도 줄바꿈 방지 */
    </style>
</head>
<body>

<div class="radio-container">
    <h2>⛪ CGN JoyManna Radio (분 단위)</h2>
    <p id="current-time"></p>
    <p id="on-air-text">Play on-Air: <span id="program-name">Wait to start..</span></p>

    <audio id="radioPlayer" controls preload="auto" loop> 
        This browser is not support this file.
    </audio>

    <button id="startButton">▶ Click to Play!</button>
    <p class="status-message" id="statusMessage"></p>
</div>

<script>
    // 시간과 분을 받아서 하루의 총 분(minute)으로 계산하는 헬퍼 함수
    function timeToMinutes(hour, minute) {
        return hour * 60 + minute;
    }

    // === 1. 스케줄 설정: [시, 분] 배열 형태로 시간대 설정 ===
    // GitHub Pages에서 사용하시는 실제 직접 링크.
    const scheduleConfig = [
        // start: 6시 00분, end: 23시 59분 (6시 00분부터 다음 방송)
        { start: [6, 0], end: [7, 0], 	name: "새벽 묵상 찬양", 	url: "https://andrewkangkl-design.github.io/CGN_JoyManna/18.mp3" },
        { start: [7, 30], end: [8, 0], 	name: "아침 찬양", 	url: "https://example.com/audio/morning.mp3" },
        { start: [8, 0], end: [9, 0], 	name: "낮 설교 방송", 	url: "https://andrewkangkl-design.github.io/CGN_JoyManna/18.mp3" },
        { start: [9, 0], end: [10, 0], 	name: "낮 설교 방송", 	url: "https://andrewkangkl-design.github.io/CGN_JoyManna/17.mp3" }, 
       { start: [10, 0], end: [11, 0], name: "저녁 기도 음악", 	url: "https://example.com/audio/evening_prayer.mp3" },
        { start: [11, 0], end: [12, 0], name: "저녁 기도 음악", 	url: "https://example.com/audio/evening_prayer.mp3" },

	//오후방송
        { start: [13, 0], end: [14, 0], name: "새벽 묵상 찬양", 	url: "https://andrewkangkl-design.github.io/CGN_JoyManna/18.mp3" },
        { start: [15, 0], end: [16, 30],name: "아침 찬양", 	url: "https://github.com/andrewkangkl-design/CGN_JoyManna/blob/main/18.mp3" },
        { start: [17, 0], end: [18, 0], name: "낮 설교 방송", 	url: "https://github.com/andrewkangkl-design/CGN_JoyManna/blob/main/18.mp3" },
        { start: [19, 0], end: [20, 0], name: "저녁 기도 음악", 	url: "https://github.com/andrewkangkl-design/CGN_JoyManna/blob/main/18.mp3" },
	//저녁방송
        { start: [21, 0], end: [22, 0], name: "새벽 묵상 찬양", 	url: "https://andrewkangkl-design.github.io/CGN_JoyManna/18.mp3" },
        { start: [23, 0], end: [23, 59],name: "아침 찬양", 	url: "https://example.com/audio/morning.mp3" }
    ];

    // 스케줄을 총 분 값으로 미리 변환
    const schedule = scheduleConfig.map(p => ({
        minStart: timeToMinutes(p.start[0], p.start[1]),
        minEnd: timeToMinutes(p.end[0], p.end[1]),
        name: p.name,
        url: p.url
    }));


    let isPlayerStarted = false; 

    function updateRadio() {
        const now = new Date();
        const hour = now.getHours();
        const minute = now.getMinutes();
        const currentMinutes = timeToMinutes(hour, minute); // 현재 시각을 총 분으로 계산

        const player = document.getElementById("radioPlayer");
        const programNameEl = document.getElementById("program-name");
        const statusMessageEl = document.getElementById("statusMessage");

        // 현재 시각 업데이트 (분까지 표시)
        document.getElementById("current-time").textContent = 
            "Current Time: " + now.toLocaleTimeString('ko-KR', { hour12: false });

        // 총 분 값을 사용하여 스케줄을 찾습니다.
        const program = schedule.find(p => currentMinutes >= p.minStart && currentMinutes <= p.minEnd);

        if (program) {
            programNameEl.textContent = program.name;
            
            if (isPlayerStarted) {
                // 1. URL이 변경되었는지 확인 (다음 시간대로 넘어감)
                if (player.src !== program.url) {
                    player.src = program.url;
                    player.load(); 
                    
                    player.play().then(() => {
                        statusMessageEl.textContent = "";
                    }).catch(err => {
                        console.error("Play error (URL 변경 후 자동 재생 차단):", err);
                        statusMessageEl.textContent = "❗ Play Error. (New program blocked play)";
                    });
                } 
                // 2. URL은 동일한데 플레이어가 멈춰있는지 확인 (파일이 끝났거나 수동 정지)
                else if (player.paused) { 
                    player.play().catch(err => {
                        console.error("자동 재생 재시도 실패:", err);
                    });
                }

            } else {
                programNameEl.textContent = program.name + " (Wait to play)";
                statusMessageEl.textContent = "Please click play button to start.";
            }

        } else {
            // 방송 시간이 아닐 때
            programNameEl.textContent = "Now, No schedule";
            player.pause();
            if (player.src) { 
                player.src = ""; 
            }
            if(isPlayerStarted) {
                statusMessageEl.textContent = "No time to schedule, Please wait...";
            } else {
                statusMessageEl.textContent = "";
            }
        }
    }

    // === 이벤트 리스너: 재생 시작 버튼 처리 ===
    document.getElementById("startButton").addEventListener('click', function() {
        if (!isPlayerStarted) {
            isPlayerStarted = true;
            this.style.display = 'none';
            updateRadio(); 
        }
    });

    // 페이지 로드 시 초기화 및 시간 표시
    updateRadio();

    // ★ 스케줄 변경을 즉시 감지하기 위해 5초마다 실행
    // 분이 바뀌는 순간(60초 주기)에만 확인하면 시간이 지연될 수 있습니다.
    setInterval(updateRadio, 5000); 
</script>
</body>
</html>
